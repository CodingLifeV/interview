<!-- TOC -->

- [架构模式](#架构模式)
  - [分层](#分层)
  - [分割](#分割)
  - [分布式](#分布式)
  - [集群](#集群)
  - [缓存](#缓存)
  - [异步](#异步)
  - [冗余](#冗余)
- [核心架构要素](#核心架构要素)
  - [可用性](#可用性)
  - [伸缩性](#伸缩性)
  - [扩展性](#扩展性)
  - [安全性](#安全性)
- [Web 前端性能优化](#web-前端性能优化)
  - [浏览器访问优化](#浏览器访问优化)
  - [CDN 加速](#cdn-加速)
  - [反向代理](#反向代理)
- [应用服务器性能优化](#应用服务器性能优化)
  - [分布式缓存](#分布式缓存)

<!-- /TOC -->

# 架构模式

## 分层

便于分工合作开发和维护，各层之间有一定的独立性，只要维持调用接口不变，各层可以根据具体问题独立演化发展而不需要其他层必须做出相应调整

必须合理规划层次边界和接口

可以使用分布式的服务框架 Dubbo 来通信，只需要简单的配置即可，不需要独立开发接口，减少了工作量

## 分割

分割即是在纵向方面对软件进行切分

将这些不同的功能和服务分割开来，包装成**高内聚低耦合**的模块单元，一方面有利于软件的开发和维护；另一方面便于不同模块的分布式部署，提高网站的并发处理能力和功能扩展能力

## 分布式

分层和分割的一个主要的目的是为了切分后的模块便于分布式部署，**即将不同的模块部署在不同的服务器上**。

分布式意外着必须通过网络，这可能对性能造成比较严重的影响；其次，服务器越多，服务器宕机的概率也越大，使网站的可用性降低；另外，数据在分布式的环境中保存数据一致性也非常苦难，分布式事务也难以保证

常用的分布式方案:

1. 分布式应用和服务。将分层和分割的应用和服务模块分布式部署
2. 分布式静态资源。网站的静态资源如 JS、CSS、Logo 图片等资源独立分布式部署，并采用独立的域名
3. 分布式数据和存储。海量数据使用 NoSQL
4. 分布式计算。处理用户没有直观感受到的后台业务，如数据仓库的数据分析，如 Hadoop 及其 MapReduce 分布式计算框架

## 集群

对于用户访问集中的模块（比如网址的首页），需要独立部署的服务器集群化，**即多台服务器部署相同应用**，通过负载均衡设备共同对外提供服务

## 缓存

缓存就是将数据存放在距离计算最近的位置加快处理速度

常用的缓存设计：

1. CDN：内容分发网络，部署在距离终端用户最近的网络服务商，在这里缓存网址的一些静态资源（较少变化的数据），就可以以较快的速度返回给用户
2. 反向代理：属于网站前端架构的一部分，部署在网站的前端，当用户到达网站的数据中心时，最先访问到的就是反向代理服务器
3. 本地缓存：在应用服务器本地缓存着热点数据，应用程序可以在本机内存中直接访问数据，无需访问数据库
4. 分布式缓存：数据缓存存在一个专门的分布式缓存集群中，应用程序通过网络通信访问缓存数据

使用缓存有两个前提条件：

1. 数据访问热点不均衡，某些数据会频繁访问，这些数据应该放在缓存中
2. 数据在某个时间段内有效，不会很快很过期，否则缓存的数据就因为已经失效而产生脏读

## 异步

在单一的服务器内部可通过多线程共享内存队列的方式实现异步，处在业务操作前面的线程将写入到队列，后面的线程从队列中读取数据进行处理；

在分布式系统中，多个服务器集群通过分布式消息队列实现异步，分布式消息队列可以看作内存队列的分布式部署

使用异步消息队列有如下好处：

1. 提高系统的可用性
2. 加快网站的响应速度
3. 消除并发访问高峰

## 冗余

要想保证在服务器宕机的情况下网站依然可以继续服务，不丢失数据，就要一定程度的服务器冗余运行，数据冗余备份，这样当某台服务器宕机时，可以将其上的服务和数据访问转移到其它机器上

# 核心架构要素

## 可用性

网站的高可用主要手段是冗余，应用部署在多台服务器上同时提供服务，数据存储在多台服务器上相互备份，任何一台服务器宕机都不会影响整体应用的整体可用，也不会导致数据丢失

1. 对于应用服务器而言：多台服务器通过负载均衡设备组成一个集群共同对外提供服务，任何一台服务器宕机，只需要把求情切换到其它服务器就可以实现应用的高可用。
2. 对于存储服务器，需要对数据进行实时备份，当服务器备份时需要将数据访问转移到可用的服务器上，并进行数据恢复以保证继续有服务器宕机时候数据依然可用

## 伸缩性

所谓伸缩性是指通过不断向集群中加入服务器的手段来缓解不断上升的用户并发访问压力和不断增长的数据存储需求

## 扩展性

衡量网站架构扩展性好坏的主要标准就是在网站增加新的业务产品时，是否可以实现对现有产品透明无影响，不需要改动或者很少改动既有业务功能就可以上新新产品

网站可扩展架构的主要手段是：

1. 事件驱动架构。通常用消息队列实现，消息的处理者作为消费者从消息队列中获取消息进行处理
2. 分布式服务。将业务和可复用服务分离开来，通过分布式服务框架调用，新增产品可以通过调用可复用的服务实现自身的业务逻辑

## 安全性

衡量网站安全架构的标准是针对现存和潜在的各种攻击与窃密手段，是否有可靠的应对策略

# Web 前端性能优化

## 浏览器访问优化

优化途径：

1. 减少 http 请求。

   每次 http 请求都需要建立连接，介绍 http 请求主要手段是合并 CSS、合并 JavaScript、合并图片等，将浏览器一次访问需要的 CSS、JavaScript 合并成一个文件，这样浏览器就只需要一次请求

2. 使用浏览器缓存

   CSS、JavaScript、图片 Logo 这些静态资源更新的频率较低，但是几乎每次 http 请求都需要，缓存在浏览器中，可以更好的提升性能

3. 启用压缩。

   在服务器端对文件进行压缩，在浏览器端对文件解压缩，可以有效减少通信传输的数据量

4. 减少 Cookie 传输

## CDN 加速

通过 CDN 服务器，将数据缓存在离用户最近的地方，使用户以最快的速度获取数据，对静态资源如图片、文件、CSS 等内容进行访问。而动态资源才会访问网站应用服务器

## 反向代理

传统代理服务：位于浏览器一侧，代理浏览器将 http 请求发送到互联网上
反向代理服务：位于网站机房一侧，代理网站 Web 服务器接收 http 请求

反向代理作用：

1. 保护网络安全，相当于在 Web 服务器和可能的网络攻击之间建立了一个屏障
2. 配置缓存功能，加速 Web 请求
3. 实现负载均衡功能

# 应用服务器性能优化

## 分布式缓存

> 网站性能优化第一定律：优先考虑使用缓存优化性能

缓存的本质使一个内存 Hash 表，主要用来存放那些读写比很高，很少变化的数据，如商品的类目信息，热门词的搜索列表信息

**合理使用缓存：**

1. 频繁修改的数据
2. 没有热点的数据
3. 数据不一致与脏读。

   一般会对缓存设置失效时间，一旦超过失效时间，就要从数据库中重新加载。可以容忍一定时间的数据不一致，例如卖家已经编辑了商品信息，但需要一段时间买家才会看到。这种延迟是可以接收的。

4. 缓存可用性

   当缓存服务奔溃时，数据库会因为完全不能承受访问压力而宕机，这种情况称为缓存雪崩。

   通过分布式缓存服务器集群，将缓存数据分布到集群多台服务器上可以一定程度上改善缓存的可用性

5. 缓存预热

6. 缓存穿透
